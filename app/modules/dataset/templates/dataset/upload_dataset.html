{% extends "base_template.html" %}

{% block title %}Upload dataset{% endblock %}

{% block content %}

    <h1 class="h2 mb-3"><b>Upload</b> dataset</h1>

    <div class="row">
        <div class="col-12 mb-3">
            <div class="alert alert-warning" role="alert" id="test_zenodo_connection_error" style="display: none">
                <div class="alert-message">

                    <h4 class="alert-heading"><i class="align-middle" data-feather="alert-triangle"></i> Limited
                        connection to the Zenodo API</h4>
                    <p class="p-0 m-0">
                        There seems to be some kind of problem with the Zenodo API and synchronization of your dataset
                        files may not be possible. We will save your files locally to eventually synchronize them with
                        Zenodo. Sorry for the inconvenience, Zenodo is an external service and we can't do
                        anything about it.
                    </p>
                </div>
            </div>
        </div>

    </div>

    {% if messages %}
        <ul>
            {% for message in messages %}
                <li>{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}

    <div class="row">

        <div class="col-xl-6 col-lg-12 col-md-12 col-sm-12">
            <div id="basic_info_form">

                {{ form.hidden_tag() }}

                <div class="row">

                    <div class="col-12">

                        <h1 class="h3 mb-3">Basic info</h1>

                        <div class="row" style="padding-left: 2rem">

                            <div class="col-lg-6 col-xs-12 col-md-12">
                                <div class="mb-3">
                                    {{ form.title.label(class="form-label") }} *
                                    {{ form.title(class="form-control") }}
                                    {% for error in form.title.errors %}
                                        <span style="color: red;">{{ error }}</span>
                                    {% endfor %}
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="mb-3">
                                    {{ form.desc.label(class="form-label") }} *
                                    {{ form.desc(rows=4, class="form-control") }}
                                    {% for error in form.desc.errors %}
                                        <span style="color: red;">{{ error }}</span>
                                    {% endfor %}
                                </div>
                            </div>

                            <div class="col-lg-6 col-6">
                                <div class="mb-3">
                                    {{ form.publication_type.label(class="form-label") }}
                                    {{ form.publication_type(class="form-control") }}
                                </div>

                            </div>

                            <div class="col-lg-6 col-6">
                                <div class="mb-3">
                                    {{ form.publication_doi.label(class="form-label") }}
                                    {{ form.publication_doi(class="form-control") }}
                                    {% for error in form.publication_doi.errors %}
                                        <span style="color: red;">{{ error }}</span>
                                    {% endfor %}
                                </div>
                            </div>

                            <div class="col-6">
                                <div class="mb-3">
                                    {{ form.tags.label(class="form-label") }}
                                    {{ form.tags(class="form-control") }}
                                    {% for error in form.tags.errors %}
                                        <span style="color: red;">{{ error }}</span>
                                    {% endfor %}
                                </div>
                            </div>

                        </div>

                        <h1 class="h3 mb-3 mt-4">
                          Authors
                        <a href="#" data-bs-toggle="modal" data-bs-target="#infoModal">
                            <i data-feather="info"></i> <!-- Usamos "info" porque Feather no tiene un ícono específico llamado "feather" para más info -->
                          </a>
                        </h1>

                        <!-- Modal -->
                        <div class="modal fade" id="infoModal" tabindex="-1" role="dialog" aria-labelledby="infoModalLabel" aria-hidden="true" style="display: none">
                          <div class="modal-dialog" role="document">
                            <div class="modal-content">
                              <div class="modal-header">
                                <h5 class="modal-title" id="infoModalLabel">Important Information</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                              </div>
                              <div class="modal-body">
                                Attention! Authors cannot be edited once the dataset has been uploaded to UVLHub. This feature will be available in future versions.
                              </div>
                              <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                              </div>
                            </div>
                          </div>
                        </div>

                        <div class="row" style="padding-left: 2rem">

                            <div class="col-lg-6 col-12 mb-3">
                                <label class="form-label">Author name</label>
                                <input class="form-control"
                                       disabled
                                       value="{{ current_user.profile.surname }}, {{ current_user.profile.name }}">
                            </div>

                            <div class="col-lg-6 col-12 mb-3">
                                <label class="form-label">Author affiliation</label>
                                <input class="form-control"
                                       disabled value="{{ current_user.profile.affiliation }}">
                            </div>

                            <div class="col-lg-6 col-12 mb-3">
                                <label class="form-label">Author ORCID</label>
                                <input class="form-control"
                                       disabled value="{{ current_user.profile.orcid }}">
                            </div>

                            <div class="col-12">

                                <div class="mb-3">

                                    <div id="authors">
                                        {% for subform in form.authors %}
                                        <div class="row author" {% if not loop.first %}
                                            style="border:2px dotted #ccc;border-radius:10px;padding:10px;margin:10px 0; background-color: white"
                                            {% endif %}
                                        >
                                            <div class="col-lg-6 col-12 mb-3">
                                                {{ subform.form.name.label(class="form-label") }}
                                                {{ subform.form.name(class="form-control", disabled=loop.first) }}
                                                {% for error in subform.name.errors %}
                                                    <span style="color: red;">{{ error }}</span>
                                                {% endfor %}
                                            </div>

                                            <div class="col-lg-6 col-12 mb-3">
                                                {{ subform.form.affiliation.label(class="form-label") }}
                                                {{ subform.form.affiliation(class="form-control", disabled=loop.first) }}
                                                {% for error in subform.name.errors %}
                                                    <span style="color: red;">{{ error }}</span>
                                                {% endfor %}
                                            </div>

                                            <div class="col-lg-6 col-12 mb-3">
                                                {{ subform.orcid.label(class="form-label") }}
                                                {{ subform.orcid(class="form-control", disabled=loop.first) }}
                                                {% for error in subform.orcid.errors %}
                                                    <span style="color: red;">{{ error }}</span>
                                                {% endfor %}
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                    <button type="button" class="btn btn-secondary" id="add_author">Add author
                                    </button>

                                </div>

                            </div>


                        </div>

                    </div>

                </div>

                <div class="row">

                    {% if error %}

                        <div class="mt-3 col-lg-6 col-12">
                            <span style="color: red;">{{ error }}</span>
                        </div>

                    {% endif %}

                </div>


            </div>
        </div>

        <div class="col-xl-6 col-lg-12 col-md-12 col-sm-12">


            <h1 class="h3 mb-3 mt-2">UVL models</h1>

            <ul class="nav nav-tabs" id="uploadTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <a class="nav-link active" id="local-tab" data-bs-toggle="tab" href="#local_tab" role="tab" aria-controls="local_tab" aria-selected="true">Local file</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="github-tab" data-bs-toggle="tab" href="#github_tab" role="tab" aria-controls="github_tab" aria-selected="false">From GitHub repo</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="zip-tab" data-bs-toggle="tab" href="#zip_tab" role="tab" aria-controls="zip_tab" aria-selected="false">From ZIP</a>
            </li>
            </ul>

            <div class="tab-content mt-3">

            <!-- LOCAL FILE -->
            <div class="tab-pane fade show active" id="local_tab" role="tabpanel" aria-labelledby="local-tab">
                <div id="uploaded_models_form" style="padding-left: 2rem">

                    <form action="{{ url_for('dataset.upload') }}" class="dropzone" id="myDropzone">
                    </form>

                    <span class="text-danger" id="alerts" style="display: none"></span>

                    <ul class="mt-2" id="file-list"></ul>

                </div>
            </div>

            <!-- GITHUB REPO -->
            <div class="tab-pane fade" id="github_tab" role="tabpanel" aria-labelledby="github-tab">

                {% include "dataset/_upload_github.html" %}

                <div id="gh_status" class="mt-3" style="display:none"></div>
            </div>


            <!-- ZIP -->
            <div class="tab-pane fade" id="zip_tab" role="tabpanel" aria-labelledby="zip-tab">

                {% include "dataset/_upload_zip.html" %}

            </div>

            </div>

            {# --- SCRIPTS: Dropzone + GitHub + ZIP (JSZip CDN incluido) --- #}

            {# Asegúrate de que Dropzone y jQuery/Bootstrap JS ya están cargados en tu base template. #}
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" integrity="sha512-Ho8qGg5k9GkQmAl9fY2Gxg9rXkqM3nI/6s4k3q5uQ5r3a9Vxjz9u0YwK2N6m9RpXq2zGx9X0cG9Kz7TgGk4h2Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

            <script>

            let incrementalIdCounter = 0;
            function generateIncrementalId() {
                return incrementalIdCounter++;
            }

            function processUploadedUVL(filename, fileObj=null) {
                // Find the file list inside the active tab (so GitHub uploads show in the GitHub tab)
                function findFileListContainer() {
                    const activePane = document.querySelector('.tab-pane.show.active');
                    if (activePane) {
                        // look for a list specifically in the active pane (local, github, or zip)
                        const fl = activePane.querySelector('#file-list') || activePane.querySelector('#file-list-gh') || activePane.querySelector('#file-list-zip');
                        if (fl) return fl;
                    }
                    // fallback to any existing lists on the page
                    return document.getElementById('file-list') || document.getElementById('file-list-gh') || document.getElementById('file-list-zip');
                }

                let fileList = findFileListContainer();

                // actions when UVL model is uploaded
                let listItem = document.createElement('li');
                let h4Element = document.createElement('h4');
                h4Element.textContent = filename;
                listItem.appendChild(h4Element);

                // generate incremental id for form
                let formUniqueId = generateIncrementalId();

                /*
                    FORM BUTTON
                */
                let formButton = document.createElement('button');
                formButton.innerHTML = 'Show info';
                formButton.classList.add('info-button', 'btn', 'btn-outline-secondary', "btn-sm");
                formButton.style.borderRadius = '5px';
                formButton.id = formUniqueId + "_button";

                // create specific form for UVL
                let formContainer = document.createElement('div');
                formContainer.id = formUniqueId + "_form";
                formContainer.classList.add('uvl_form', "mt-3");
                formContainer.style.display = "none";

                formButton.addEventListener('click', function () {
                    if (formContainer.style.display === "none") {
                        formContainer.style.display = "block";
                        formButton.innerHTML = 'Hide info';
                    } else {
                        formContainer.style.display = "none";
                        formButton.innerHTML = 'Add info';
                    }
                });

                // remove button
                let removeButton = document.createElement('button');
                removeButton.innerHTML = 'Delete model';
                removeButton.classList.add("remove-button", "btn", "btn-outline-danger", "btn-sm");
                removeButton.style.borderRadius = '5px';

                removeButton.addEventListener('click', function () {
                    fileList.removeChild(listItem);

                    fetch('/dataset/file/delete', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ file: filename })
                    })
                    .then(r => {
                        if (r.ok) {
                            console.log('Deleted file from server');
                        }
                    })
                    .catch(e => console.warn('Error deleting file:', e));
                });

                // append space, buttons and form
                listItem.appendChild(document.createTextNode(" "));
                listItem.appendChild(formButton);
                listItem.appendChild(removeButton);

                formContainer.innerHTML = `
                    <div class="row">
                        <input type="hidden" value="${filename}" name="feature_models-${formUniqueId}-uvl_filename">
                        <div class="col-12">
                            <div class="row">
                                <div class="col-12">
                                    <div class="mb-3">
                                        <label class="form-label">Title</label>
                                        <input type="text" class="form-control" name="feature_models-${formUniqueId}-title">
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="mb-3">
                                        <label class="form-label">Description</label>
                                        <textarea rows="4" class="form-control" name="feature_models-${formUniqueId}-desc"></textarea>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-12">
                                    <div class="mb-3">
                                        <label class="form-label" for="publication_type">Publication type</label>
                                        <select class="form-control" name="feature_models-${formUniqueId}-publication_type">
                                            <option value="none">None</option>
                                            <option value="annotationcollection">Annotation Collection</option>
                                            <option value="book">Book</option>
                                            <option value="section">Book Section</option>
                                            <option value="conferencepaper">Conference Paper</option>
                                            <option value="datamanagementplan">Data Management Plan</option>
                                            <option value="article">Journal Article</option>
                                            <option value="patent">Patent</option>
                                            <option value="preprint">Preprint</option>
                                            <option value="deliverable">Project Deliverable</option>
                                            <option value="milestone">Project Milestone</option>
                                            <option value="proposal">Proposal</option>
                                            <option value="report">Report</option>
                                            <option value="softwaredocumentation">Software Documentation</option>
                                            <option value="taxonomictreatment">Taxonomic Treatment</option>
                                            <option value="technicalnote">Technical Note</option>
                                            <option value="thesis">Thesis</option>
                                            <option value="workingpaper">Working Paper</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-6">
                                    <div class="mb-3">
                                        <label class="form-label" for="publication_doi">Publication DOI</label>
                                        <input class="form-control" name="feature_models-${formUniqueId}-publication_doi" type="text" value="">
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="mb-3">
                                        <label class="form-label">Tags (separated by commas)</label>
                                        <input type="text" class="form-control" name="feature_models-${formUniqueId}-tags">
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="mb-3">
                                        <label class="form-label">UVL version</label>
                                        <input type="text" class="form-control" name="feature_models-${formUniqueId}-uvl_version">
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="mb-3">
                                        <label class="form-label">Authors</label>
                                        <div id="${formUniqueId}_authors"></div>
                                        <button type="button" class="add_author_to_uvl btn btn-secondary" id="${formUniqueId}_authors_button">Add author</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                listItem.appendChild(formContainer);
                fileList.appendChild(listItem);

                document.getElementById("upload_dataset").style.display = "block";
            }
            

            /* ---------- Dropzone config  ---------- */

            if (typeof Dropzone !== 'undefined') {
                Dropzone.autoDiscover = false;

                Dropzone.options.myDropzone = {
                    url: "/dataset/file/upload",
                    paramName: 'file',
                    maxFilesize: 10,
                    acceptedFiles: '.food',
                    init: function () {
                        let alerts = document.getElementById('alerts');
                        this.on('addedfile', function (file) {
                            alerts.innerHTML = '';
                            alerts.style.display = 'none';
                        });

                        this.on('success', function (file, response) {
                            console.log("File uploaded via Dropzone: ", response);
                            if (response && response.filename) {
                                processUploadedUVL(response.filename, file);
                            } else if (response && response.files) {
                                response.files.forEach(fn => processUploadedUVL(fn));
                            } else {
                                processUploadedUVL(file.name, file);
                            }
                        });

                        this.on('error', function (file, response) {
                            console.error("Error uploading file: ", response);
                            let alert = document.createElement('p');
                            alert.textContent = 'UVL not valid: ' + file.name;
                            alerts.appendChild(alert);
                            alerts.style.display = 'block';
                        });
                    }
                };

                document.addEventListener('DOMContentLoaded', function () {
                    let dzEl = document.getElementById('myDropzone');
                    if (dzEl && !dzEl.dropzone) {
                        new Dropzone(dzEl, Dropzone.options.myDropzone);
                    }
                });
            }

            /* ---------- GitHub import ---------- */

            document.getElementById("import_repo_btn").addEventListener("click", function (e) {
                e.preventDefault();
                const urlInput = document.getElementById("gh_url").value.trim();
                let branch = document.getElementById("gh_branch").value.trim() || 'main';
                const status = document.getElementById("gh_status");
                
                // Clear previous search results
                const fileListGh = document.getElementById("file-list-gh");
                if (fileListGh) {
                    fileListGh.innerHTML = "";
                }
                
                status.style.display = "block";
                status.innerHTML = "Analyzing repo...";

                const m = urlInput.match(/github\.com\/([^\/]+)\/([^\/]+)(?:\/|$)/i);
                if (!m) {
                    status.innerHTML = "<span class='text-danger'>Invalid GitHub URL</span>";
                    return;
                }
                const owner = m[1];
                const repo = m[2];

                // Usar API Git trees para listar ficheros (recursivo)
                const treesUrl = `https://api.github.com/repos/${owner}/${repo}/git/trees/${encodeURIComponent(branch)}?recursive=1`;

                fetch(treesUrl)
                .then(r => {
                    if (!r.ok) throw new Error("GitHub repository or Branch not found");
                    return r.json();
                })
                .then(data => {
                    if (!data.tree) throw new Error("Unexpected response from GitHub API");
                    const uvlFiles = data.tree.filter(item => item.type === 'blob' && (item.path.endsWith('.food')));
                    if (uvlFiles.length === 0) {
                        status.innerHTML = "<span class='text-warning'>No .food files found in the repository</span>";
                        return;
                    }
                    status.innerHTML = `Found ${uvlFiles.length} files. Downloading and uploading...`;

                    let uploaded = 0;
                    uvlFiles.forEach(item => {
                        const rawUrl = `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/${item.path}`;
                        fetch(rawUrl)
                        .then(r => {
                            if (!r.ok) throw new Error("Could not be download: " + item.path);
                            return r.blob();
                        })
                        .then(blob => {
                            const file = new File([blob], item.path.split('/').pop(), { type: 'application/octet-stream' });
                            const form = new FormData();
                            form.append('file', file);

                            return fetch('/dataset/file/upload', {
                                method: 'POST',
                                body: form
                            });
                        })
                        .then(r => {
                            if (!r.ok) return r.text().then(t => { throw new Error(t || ('Server error ' + r.status)); });
                            const ct = r.headers.get('content-type') || '';
                            if (ct.indexOf('application/json') === -1) return r.text().then(t => { throw new Error(t || 'Invalid JSON response'); });
                            return r.json();
                        })
                        .then(resp => {
                            if (resp && resp.filename) {
                                processUploadedUVL(resp.filename);
                            } else {
                                processUploadedUVL(item.path.split('/').pop());
                            }
                            uploaded++;
                            status.innerHTML = `${uploaded}/${uvlFiles.length} uploaded`;
                        })
                        .catch(err => {
                            console.error('Error procesando', item.path, err);
                            status.innerHTML = "<span class='text-danger'>Error uploading " + item.path + ": " + err.message + "</span>";
                        });
                    });
                })
                .catch(err => {
                    console.error(err);
                    status.innerHTML = "<span class='text-danger'>Error importing repository: " + err.message + "</span>";
                });
            });


            /* ---------- ZIP import ---------- */
            // Helper to dynamically load a script and return a Promise that resolves when loaded
            function loadScript(url) {
                return new Promise(function (resolve, reject) {
                    const s = document.createElement('script');
                    s.src = url;
                    s.async = true;
                    s.onload = () => resolve();
                    s.onerror = (e) => reject(new Error('Failed to load script ' + url));
                    document.head.appendChild(s);
                });
            }

            document.getElementById("upload_zip_btn").addEventListener("click", function (e) {
                e.preventDefault();
                const input = document.getElementById("zip_input");
                const status = document.getElementById("zip_status");
                if (!input.files || !input.files[0]) {
                    status.style.display = "block";
                    status.innerHTML = "<span class='text-danger'>Please select a ZIP file first</span>";
                    return;
                }

                const proceed = function() {
                    const zipFile = input.files[0];
                    status.style.display = "block";
                    status.innerHTML = "Please select a ZIP file first";

                    const jszip = new JSZip();
                    jszip.loadAsync(zipFile).then(zip => {
                        const uvlEntries = [];
                        zip.forEach((relativePath, zipEntry) => {
                            if (!zipEntry.dir && (relativePath.endsWith('.food'))) {
                                uvlEntries.push(zipEntry);
                            }
                        });

                        if (uvlEntries.length === 0) {
                            status.innerHTML = "<span class='text-warning'>No .food files found in the ZIP</span>";
                            return;
                        }

                        status.innerHTML = `Found ${uvlEntries.length} files. Uploading...`;
                        let uploaded = 0;

                        uvlEntries.forEach(entry => {
                            entry.async('blob').then(blob => {
                                const fileName = entry.name.split('/').pop();
                                const file = new File([blob], fileName, { type: 'application/octet-stream' });
                                const form = new FormData();
                                form.append('file', file);

                                    return fetch('/dataset/file/upload', {
                                        method: 'POST',
                                        body: form
                                    });
                                })
                                .then(r => {
                                    if (!r.ok) return r.text().then(t => { throw new Error(t || ('Server error ' + r.status)); });
                                    const ct = r.headers.get('content-type') || '';
                                    if (ct.indexOf('application/json') === -1) return r.text().then(t => { throw new Error(t || 'Invalid JSON response'); });
                                    return r.json();
                                })
                                .then(resp => {
                                    if (resp && resp.filename) {
                                        processUploadedUVL(resp.filename);
                                    } else {
                                        processUploadedUVL(entry.name.split('/').pop());
                                    }
                                    uploaded++;
                                    status.innerHTML = `${uploaded}/${uvlEntries.length} uploaded`;
                                })
                                .catch(err => {
                                    console.error('Error subiendo entry', entry.name, err);
                                    status.innerHTML = "<span class='text-danger'>Error subiendo " + entry.name + ": " + err.message + "</span>";
                                });
                        });
                    }).catch(err => {
                        console.error('Error leyendo ZIP', err);
                        status.innerHTML = "<span class='text-danger'>Error leyendo ZIP: " + err.message + "</span>";
                    });
                };

                // Ensure JSZip is available; if not, load it dynamically
                if (typeof JSZip === 'undefined') {
                    loadScript('https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js')
                        .then(() => proceed())
                        .catch(err => {
                            console.error('Error cargando JSZip', err);
                            status.style.display = 'block';
                            status.innerHTML = "<span class='text-danger'>JSZip library could not be loaded</span>";
                        });
                } else {
                    proceed();
                }
            });

            </script>

        </div>

    </div>

    <div class="row" id="upload_dataset" style="display: none">

        <div class="col-12">

            <hr>

            <h1 class="h3 mb-3 mt-2">Upload dataset</h1>

            <div style="padding-left: 2rem">

                <label class="form-check">
                    <input id="agreeCheckbox" class="form-check-input" type="checkbox" value="">
                    <span class="form-check-label" style="font-size: 15px">
                                I agree to have my feature models automatically uploaded to Zenodo and made available to the public according to the <a
                            href="https://en.wikipedia.org/wiki/Open_science" target="_blank">Open Science</a> manifesto
                            </span>
                </label>

                <button id="upload_button" class="btn btn-primary mt-2" disabled>
                    <i data-feather="upload" class="center-button-icon"></i>
                    Upload dataset</button>

                <div id="loading" style="display: none">
                    <img width="40px" src="{{ url_for("static", filename="gifs/loading.svg") }}"/>
                    Uploading dataset, please wait...
                </div>

                <div class="row">
                    <div class="col-12 mb-3">

                    </div>
                </div>

                <div class="alert alert-error" role="alert" id="upload_error"
                     style="display: none">
                    <div class="alert-message">

                        <h4 class="alert-heading"><i class="align-middle" data-feather="alert-triangle"></i> Limited
                            connection to the Zenodo API</h4>
                        <p class="p-0 m-0">
                            There seems to be some kind of problem with the Zenodo API and synchronization of your
                            dataset
                            files may not be possible. We will save your files locally to eventually synchronize
                            them with
                            Zenodo. Sorry for the inconvenience, Zenodo is an external service and we can't do
                            anything about it.
                        </p>
                    </div>
                </div>


                <span class="text-danger mt-2" id="upload_error" style="display: none">

                    </span>

                <script>
                    const checkbox = document.getElementById('agreeCheckbox');
                    const upload_button = document.getElementById('upload_button');

                    checkbox.addEventListener('change', function () {
                        upload_button.disabled = !checkbox.checked;
                    });
                </script>

            </div>




        </div>

    </div>


{% endblock %}

{% block scripts %}
    <script src="{{ url_for('zenodo.scripts') }}"></script>
    <script src="{{ url_for('dataset.scripts') }}"></script>
{% endblock %}