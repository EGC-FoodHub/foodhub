{% extends "base_template.html" %}

{% block title %}Trending Datasets{% endblock %}

{% block content %}
<div class="container">
    <h1 class="h2 mb-3">Trending Datasets</h1>
    
    {% if error %}
    <div class="alert alert-danger">
        <strong>Error:</strong> {{ error }}
    </div>
    {% endif %}
    
    <div class="trending-tabs mb-4">
        <a href="?period=week&limit=10" class="btn {% if period == 'week' %}btn-primary{% else %}btn-outline-primary{% endif %} me-2">
            This Week
        </a>
        <a href="?period=month&limit=10" class="btn {% if period == 'month' %}btn-primary{% else %}btn-outline-primary{% endif %}">
            This Month
        </a>
    </div>
    
    <h2 class="h3 mb-4">{{ period_label }}</h2>
    
    {% if trending %}
        <div class="datasets-list">
            {% for dataset in trending %}
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-3">
                            <span class="badge bg-primary me-2" style="font-size: 1.1em;">#{{ loop.index }}</span>
                            <h3 class="h5 mb-0">
                                {% if dataset.doi %}
                                    <a href="{{ dataset.doi }}" target="_blank">{{ dataset.title }}</a>
                                {% else %}
                                    {{ dataset.title }}
                                {% endif %}
                            </h3>
                        </div>
                        
                        {% if dataset.main_author and dataset.main_author.name %}
                        <p class="mb-2">
                            <strong>Author:</strong> {{ dataset.main_author.name }}
                            {% if dataset.main_author.affiliation %}
                                ({{ dataset.main_author.affiliation }})
                            {% endif %}
                        </p>
                        {% endif %}
                        
                        {% if dataset.community %}
                        <p class="mb-2">
                            <strong>Community:</strong> 
                            <span class="badge bg-info">{{ dataset.community }}</span>
                        </p>
                        {% endif %}
                        
                        <div class="dataset-stats d-flex gap-3 mb-3">
                            <span class="text-muted">
                                <i data-feather="download" class="align-middle"></i>
                                <strong>{{ dataset.recent_downloads }}</strong> downloads
                            </span>
                            <span class="text-muted">
                                <i data-feather="eye" class="align-middle"></i>
                                <strong>{{ dataset.recent_views }}</strong> views
                            </span>
                            <span class="text-muted">
                                <i data-feather="trending-up" class="align-middle"></i>
                                Score: <strong>{{ dataset.trending_score }}</strong>
                            </span>
                        </div>
                        
                        {% if dataset.doi %}
                        <p class="mb-3">
                            <strong>DOI:</strong> 
                            <a href="{{ dataset.doi }}" target="_blank">{{ dataset.doi }}</a>
                        </p>
                        {% endif %}
                        
                        <div class="mt-3">
                            {% if dataset.id %}
                            <a href="/food/dataset/{{ dataset.id }}" 
                               class="btn btn-primary btn-sm me-2 trending-view-link"
                               data-dataset-id="{{ dataset.id }}">
                                <i data-feather="eye" class="align-middle"></i>
                                View Dataset
                            </a>
                            <a href="/dataset/download/{{ dataset.id }}" 
                               class="btn btn-outline-primary btn-sm trending-download-link"
                               data-dataset-id="{{ dataset.id }}">
                                <i data-feather="download" class="align-middle"></i>
                                Download Dataset
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        
        <div class="mt-4">
            <a href="/" class="btn btn-outline-secondary">
                <i data-feather="home" class="align-middle"></i>
                Back to Home
            </a>
        </div>
        
    {% else %}
        <div class="alert alert-info">
            <i data-feather="info" class="align-middle"></i>
            No trending datasets found for {{ period_label|lower }}.
        </div>
        <a href="/" class="btn btn-primary">
            <i data-feather="home" class="align-middle"></i>
            Back to Home
        </a>
    {% endif %}
</div>
{% endblock %}